<!DOCTYPE html>
<html lang="en">
<head>
  <title>Skiing in Oregon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--add required stylesheets-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <!--leaflet css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">


  <!--add favicon for the web page-->
  <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">

  <!--Fonts-->
  <link href="https://fonts.googleapis.com/css?family=Cairo" rel="stylesheet">


  <link rel="stylesheet" type="text/css" href="css/storymap.2.5.css">
  <!--add required libraries-->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>
  <!--jquery-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

  <!--boostrap-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!--leaflet.ajax for asynchronously adding geojson data-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

  <!--mini globle map-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
  <script src="js/globeminimap.js"></script>

  <!--story map plugin-->
  <script src="js/storymap.2.5.js"></script>

  <!--chroma js-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>

</head>





<body>
<div id="storymap" class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 storymap-story">
            <section data-scene="overview" data-background="assets/ashland.mp4">
                <div class="fullscreen text-center">
                    <h1 class="display-4 d-flex justify-content-center">Skiing in Oregon</h1>
                    <small class="d-flex justify-content-center" style="color: black">
                        A presentation on skiing and snow in the state of Oregon.
                    </small>
                </div>
            </section>
            <section data-scene="portland">
                <h2>0</h2>

            </section>

            <section data-scene="corvallis">
                <h2>1</h2>

            </section>

            <section data-scene="eugene">
                <h2>2</h2>

            </section>

            <section data-scene="salem">
                <h2>3</h2>

            </section>
            <section data-scene="bend">
                <h2>4</h2>

            </section>

            <section data-scene="oregon">
                <h2>5</h2>

            </section>

            <section data-scene="end" data-background="images/end.png">
                <div class="fullscreen text-center">
                    <h1 class="display-4 d-flex justify-content-center">Enjoy the Season!</h1>
                    <small class="d-flex justify-content-center" style="color: rgba(255,255,255,0.95)">Your
                        Acknowledgement goes here
                    </small>
                </div>
            </section>

        </div>
        <!--map div-->
        <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>


    <dl>
        <dt>
            <!--facebook icon-->
            <a class="fab fa-facebook-square btn"
               href="https://facebook.com/sharer.php?u=http://geoviz.ceoas.oregonstate.edu/storymap/examples/2.5/video.html"
               target="_blank"></a>
        </dt>
        <dt>
            <!--facebook icon-->
            <a class="fab fa-github btn" href="https://github.com/jakobzhao/storymap" style="top:40px"
               target="_blank"></a>
        </dt>
        <dt>
            <!--info icon-->
            <i class="fas fa-info-circle btn" style="top:60px" data-toggle="modal" data-target="#info-modal"></i>
        </dt>
    </dl>

    <!--the info page-->
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About</h4>
                </div>
                <div class="modal-body">
                    <p>This is a web map of major cities in Oregon. It is mainly made as a demo for a course GEOG 371:
                        Web Mapping provided by Oregon State University. The story map library is derived from the
                        storymap plugin for leaflet at <a>http://atlefren.github.io/storymap/</a>, and its functionality
                        relies on both leaflet and Boostrap.</p>
                    <p><b>storymap.js</b> | Released Date: 02/20/2017 | Version: 2.5 | MIT License </p>
                    <p><b>Author: Bo Zhao</b> | College of Earth, Ocean, Atmospheric Science | Oregon State University
                    </p>
                    <p>The context about Oregon cities was collected from Wikipedia.</p>
                    <p>The <a href="https://www.youtube.com/watch?v=UJ_vQC9PNY4">background video</a> on the front page
                        was clipped from Youtube. </p>
                    <p>The favicon image was acquired from <a>http://www.udlcenter.org/advocacy/state/oregon.</a></p>
                    <p>This story map uses geospatial data from mapbox, Google Earth Engine, ESRI Map, Open Street Maps
                        and Oregon Explorer.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- main javascript -->
<script type="text/javascript">

  var grades = [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55];


  var outsideColor = chroma('slategrey');
  var colors = chroma.scale(['blue', 'purple', 'pink']).colors(grades.length);


    // Create Legend Contents in html format
    var county_legend = '<i style="background: orange; opacity: 0.5"></i><p><b>Resorts</b></p>';
    var forest_legend = '<i style="background: green; opacity: 0.5"></i><p><b>Forest</b></p>';
    var snowfall_legend = '<b>Average Yearly Snowfall (in)</b><br/>' +
      '<i style="background: ' + colors[0] + ' opacity: 0.5"></i><p> 0 - 4</p>' +
      '<i style="background: ' + colors[1] + '; opacity: 0.5"></i><p> 5 - 9</p>' +
      '<i style="background: ' + colors[2] + '; opacity: 0.5"></i><p> 10 - 14</p>' +
      '<i style="background: ' + colors[3] + '; opacity: 0.5"></i><p> 15 - 19</p>' +
      '<i style="background: ' + colors[4] + '; opacity: 0.5"></i><p> 20 - 24</p>' +
      '<i style="background: ' + colors[5] + '; opacity: 0.5"></i><p> 25 - 29</p>' +
      '<i style="background: ' + colors[6] + '; opacity: 0.5"></i><p> 30 - 34</p>' +
      '<i style="background: ' + colors[7] + '; opacity: 0.5"></i><p> 35 - 39</p>' +
      '<i style="background: ' + colors[8] + '; opacity: 0.5"></i><p> 40 - 44</p>' +
      '<i style="background: ' + colors[9] + '; opacity: 0.5"></i><p> 45 - 49</p>' +
      '<i style="background: ' + colors[10] + '; opacity: 0.5"></i><p> 50 - 54</p>' +
      '<i style="background: ' + colors[11] + '; opacity: 0.5"></i><p> 55+</p>';


    // For each layer, the first variable is the layer, the second is the legend. The layer variable can be any kinds of layers that leaflet.js supports.
    // var layers = {
    //      layer1: {layer: layer1, legend: legend1},
    //      layer2: {layer: layer2, legend: legend2}
    //      ...
    // }

    var layers = {
        ESRI: {layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')},
        resorts: {
            layer: L.geoJson.ajax('assets/resorts.geojson', {
                onEachFeature: function(feature, layer){
                  var list = "<dl><dt>Name: </dt>"
                    + "<dd>" + feature.properties.Name + "</dd>"
                    + "<dt>Difficulty: </dt>"
                    + "<dd>" + feature.properties.Difficulty + "</dd>"
                    + "<dt>Open Acreage: </dt>"
                    + "<dd>" + feature.properties.Acreage + "</dd></dl>";
                  layer.bindPopup(list);
                  layer.on('mouseover', function(e){
                    this.openPopup();
                  });
                  layer.on('mouseout', function(e){
                    this.closePopup();
                  });
                },
                color: 'orange',
                weight: 2,
                opacity: 0.3,
            }),
            legend: county_legend
        },
        counties: {
          layer: L.geoJson.ajax('assets/snowCounties.geojson',{
            onEachFeature: function(feature, layer){
              var snowValue = feature.properties.Snowfall;
              popup = new L.Popup();
              //popup.setLatLng(new L.LatLng(44, -122));
              popup.setContent(snowValue + " in.");
              layer.bindPopup(popup);
              layer.on('mouseover', function(e){
                this.openPopup();
              });
              layer.on('mouseout', function(e){
                this.closePopup();
              });
            },
            style: style
          }),
          legend: snowfall_legend
        },
        stateBorder: {
          layer: L.geoJson.ajax('assets/oregonBorder.geojson', {fillOpacity: 0, weight: 1, color: 'grey'})
        },
        snowfall: {
            layer: L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{x}/{y}'),
            legend: forest_legend
        },
        test: {  // https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/export?dpi=96&transparent=true&format=png32&layers=show%3A3%2C7&bbox=-14009266.181845024%2C4329028.4521384975%2C-12120965.835088532%2C5821079.244264741&bboxSR=102100&imageSR=102100&size=1544%2C1220&f=image
                // https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/?service=wms&version=1.3.0&request=GetCapabilities&service=WMS&request=GetMap&layers=&styles=&format=image%2Fjpeg&transparent=false&version=1.1.1&width=256&height=256&srs=EPSG%3A3857&bbox=-12523442.714243278,5009377.085697314,-10018754.171394622,7514065.628545967
            layer: L.tileLayer.wms('https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/export?dpi=96&transparent=true&format=png32&layers=show%3A3%2C7&bboxSR=102100&imageSR=102100&f=image'),
            legend: forest_legend
        },
        satellite: {
            layer: L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {
                id: 'mapbox.satellite'
            })
        },
        cartodb_dark: {layer: L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png')}
    };

    var scenes = {
        overview: {lat: 44.0000000, lng: -123.5000000, zoom: 7, name: 'Cover Page', layers: []},
        bend: {lat: 44.256374, lng: -122.6576876, zoom: 8, name: 'Bend', layers: [layers.resorts, layers.stateBorder]},
        portland: {lat: 44.256374, lng: -122.6576876, zoom: 7.4, name: 'Portland', layers: [layers.counties]},
        corvallis: {lat: 44.5701158, lng: -123.2949388, zoom: 14, name: 'Corvallis', layers: [layers.ESRI]},
        eugene: {lat: 44.0549563, lng: -123.0958048, zoom: 4, name: 'Eugene', layers: [layers.test]},
        salem: {lat: 44.9419055, lng: -123.0356407, zoom: 13, name: 'Salem', layers: []},
        oregon: {lat: 44.256374, lng: -122.6576876, zoom: 8, name: 'Oregon State', layers: [layers.test]},
        end: {lat: 44.0000000, lng: -123.5000000, zoom: 7, name: 'The End'}
    };

    $('#storymap').storymap({
        scenes: scenes,
        baselayer: layers.cartodb_dark,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        credits: "",
        loader: true,
        scalebar: false,
        flyo: true,
        navwidget: true,

        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map($(".storymap-map")[0], {
                zoomControl: false, scrollWheelZoom: false, fadeAnimation: true,
                zoomAnimation: true
            }).setView([44, -120], 7);

            //add an miniglobe
            new L.Control.GlobeMiniMap({
                marker: 'red',
                position: 'bottomright'
            }).addTo(map);


            return map;
        }
    });



    function getColor(feature){
      if(feature.properties.STATE != 41){
        return outsideColor;
      }
      else{
        for(var i=0; i<grades.length-1; i++){
          if(feature.properties.Snowfall > grades[i] && feature.properties.Snowfall < grades[i+1]){
            return colors[i];
          }
        }
        if(feature.properties.Snowfall > grades[grades.length-1]){
          return colors[grades.length -1];
        }
      }
    }

    function style(feature){
      return{
        weight: 2,
        opacity: 1,
        color: 'grey',
        fillOpacity: .6,
        fillColor: getColor(feature)
      };
    }
</script>
</body>
</html>
