<!DOCTYPE html>
<html lang="en">
<head>
  <title>Skiing in Oregon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--add required stylesheets-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <!--leaflet css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">


  <!--add favicon for the web page-->
  <link rel="shortcut icon" href="images/skiierIcon.png" type="image/x-icon">

  <!--Fonts-->
  <link href="https://fonts.googleapis.com/css?family=Cairo" rel="stylesheet">


  <link rel="stylesheet" type="text/css" href="css/storymap.2.5.css">
  <!--add required libraries-->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>
  <!--jquery-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

  <!--boostrap-->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!--leaflet.ajax for asynchronously adding geojson data-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

  <!--mini globle map-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
  <script src="js/globeminimap.js"></script>

  <!--story map plugin-->
  <script src="js/storymap.2.5.js"></script>

  <!--chroma js-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>

</head>

<style>

.far{
  color: white
}
body {
  font-family: 'Georgia';
}
</style>



<body>
<div id="storymap" class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 storymap-story">
            <section data-scene="overview" data-background="assets/ashland.mp4">
                <div class="fullscreen text-center">
                    <h1 class="display-4 d-flex justify-content-center">Skiing in Oregon</h1>
                    <small class="d-flex justify-content-center" style="color: black">
                        A presentation on skiing and snow in the state of Oregon.
                    </small>
                </div>
            </section>
            <section data-scene="mtHood">
                <h2>Mt. Hood</h2>
                <p> Oregon is one of the best locations in the United States for skiing, and attracts winter sport athletes from around the country.
                  Mountains across the state are blanketed with snow throughout the year, and each one provides a unique experience for it's visitors.
                  Mt. Hood is one of the largest, sporting 85 runs ranging up to 3 miles long! However, there's plenty more snow and mountains to explore throughout
                  this great state. </p>

            </section>

            <section data-scene="countySnowDist">
                <h2>Oregon Snow Distribution By County</h2>
                <p>So what are the best spots to skii at in the state? Unfortunately the coast and the left side has quite a bit less snow to offer,
                  but the center of the stae is rich and full of snow. We can see the annual averages, and from there, which counties are the best to visit
                  if you're looking for adventure. </p>

            </section>

            <section data-scene="countrySnowOverview">
                <h2>United States Snowfall</h2>
                <img src="images/snowLegend.PNG" alt="Snow Legend"></img>
                <p> While Oregon doesn't have the most snow out of the Northwest portion of North America, it is definately home to a few hot spots.
                  The focused range of snowy mountains means that fresh powder is always withing driving range, but you won't have to worry too much about
                  the drive up, or the roads being snowed over. Let's continue and take a closer look at the state of Oregon.

            </section>

            <section data-scene="oregonSnow">
                <h2>Oregon Snowfall</h2>
                <img src="images/snowLegend.PNG" alt="Snow Legend"></img>
                <p> Skiing in Oregon is largely focused on the Cascade range of mountains which run through the state. The pink areas of high snow concentration
                  are where the biggest and best mountains and resorts lie. </p>

            </section>

            <section data-scene="resortMap">
                <h2>Oregon Ski Resorts</h2>
                <p> The vast majority of winter athletes will spend their time skiing and snowboarding at Oregon's resorts. These range from large to small,
                  with a wide variety of different types of skiing, terrain, weather, and foliage. Each resort also has different difficulties catering to a
                  wide variety of skiiers. Big or small, each resort provides a unique experience, and every skiier should make it a point to visit at least a few.
                </p>(mouse over icons to see more info about each resort) </p> So now that we've explored the winter terrain of Oregon, whats next? </p>

            </section>

            <section data-scene="end" data-background="images/end.png">
                <div class="fullscreen text-center">
                    <h1 class="display-4 d-flex justify-content-center">Enjoy the Season!</h1>
                    <small class="d-flex justify-content-center" style="color: rgba(255,255,255,0.95)">

                    </small>
                </div>
            </section>

        </div>
        <!--map div-->
        <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>


    <dl>
        <dt>
            <!--facebook icon-->
            <a class="fab fa-twitter-square btn"
               href="https://twitter.com/share?ref_src=twsrc%5Etfw"
               target="_blank"></a>
        </dt>
        <dt>
            <!--github icon-->
            <a class="fab fa-github btn" href="https://github.com/MarkleyO/oregonSkiStoryMap" style="top:40px"
               target="_blank"></a>
        </dt>
        <dt>
            <!--info icon-->
            <i class="fas fa-info-circle btn" style="top:60px" data-toggle="modal" data-target="#info-modal"></i>
        </dt>
    </dl>

    <!--the info page-->
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About</h4>
                </div>
                <div class="modal-body">
                    <p>This is my storymap created for Lab 5 in GEOG 371. I chose to do an overview of Skiing
                      in the state of Oregon. Some of the data is my own, while some is coming from outside sources.
                      The story map is built with the plugin for leaflet found here: <a>http://atlefren.github.io/storymap/</a>, and its functionality
                        relies on both leaflet and Boostrap.</p>
                    <p><b>storymap.js</b> | Released Date: 02/20/2017 | Version: 2.5 | MIT License </p>
                    <p><b>Author: Owen Markley</b> | Computer Science Student | Oregon State University
                    </p>
                    <p>The context about Oregon cities was collected from Wikipedia.</p>
                    <p>The <a href="https://www.youtube.com/watch?v=Qj9nb7kIsjQ">background video</a> was downloaded from youtube.com. </p>
                    <p>Favicon image comes from <a>https://thenounproject.com.</a></p>
                    <p>Story uses data from a variety of sources including, ESRI Map, Open Street Maps, Google Maps, and NOHRSC.</p>
                    <p>County snowfall data was provided by BestPlaces.com; County borders were provided by http://eric.clst.org/tech/usgeojson/.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- main javascript -->
<script type="text/javascript">

  var grades = [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55];


  var outsideColor = chroma('slategrey');
  var colors = chroma.scale(['blue', 'purple', 'pink']).colors(grades.length);


    // Create Legend Contents in html format
    var resort_legend = '<i class="far fa-snowflake fa-lg test"></i><p><b>Resorts</b></p>';
    var snowfall_legend = '<b>Average Yearly Snowfall (in)</b><br/>' +
      '<i style="background: ' + colors[0] + ' opacity: 0.5"></i><p> 0 - 4</p>' +
      '<i style="background: ' + colors[1] + '; opacity: 0.5"></i><p> 5 - 9</p>' +
      '<i style="background: ' + colors[2] + '; opacity: 0.5"></i><p> 10 - 14</p>' +
      '<i style="background: ' + colors[3] + '; opacity: 0.5"></i><p> 15 - 19</p>' +
      '<i style="background: ' + colors[4] + '; opacity: 0.5"></i><p> 20 - 24</p>' +
      '<i style="background: ' + colors[5] + '; opacity: 0.5"></i><p> 25 - 29</p>' +
      '<i style="background: ' + colors[6] + '; opacity: 0.5"></i><p> 30 - 34</p>' +
      '<i style="background: ' + colors[7] + '; opacity: 0.5"></i><p> 35 - 39</p>' +
      '<i style="background: ' + colors[8] + '; opacity: 0.5"></i><p> 40 - 44</p>' +
      '<i style="background: ' + colors[9] + '; opacity: 0.5"></i><p> 45 - 49</p>' +
      '<i style="background: ' + colors[10] + '; opacity: 0.5"></i><p> 50 - 54</p>' +
      '<i style="background: ' + colors[11] + '; opacity: 0.5"></i><p> 55+</p>';


    // For each layer, the first variable is the layer, the second is the legend. The layer variable can be any kinds of layers that leaflet.js supports.
    // var layers = {
    //      layer1: {layer: layer1, legend: legend1},
    //      layer2: {layer: layer2, legend: legend2}
    //      ...
    // }

    var layers = {
        ESRI: {layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')},
        resorts: {
            layer: L.geoJson.ajax('assets/resorts.geojson', {
                onEachFeature: function(feature, layer){
                  var list = "<dl><dt>Name: </dt>"
                    + "<dd>" + feature.properties.Name + "</dd>"
                    + "<dt>Difficulty: </dt>"
                    + "<dd>" + feature.properties.Difficulty + "</dd>"
                    + "<dt>Open Acreage: </dt>"
                    + "<dd>" + feature.properties.Acreage + "</dd></dl>";
                  layer.bindPopup(list);
                  layer.on('mouseover', function(e){
                    this.openPopup();
                  });
                  layer.on('mouseout', function(e){
                    this.closePopup();
                  });
                },
                pointToLayer: function(feature, latlng){
                  return L.marker(latlng, {icon: L.divIcon({className: "far fa-snowflake fa-lg test"})});
                }
            }),
            legend: resort_legend
        },
        counties: {
          layer: L.geoJson.ajax('assets/snowCounties.geojson',{
            onEachFeature: function(feature, layer){
              var snowValue = feature.properties.Snowfall;
              popup = new L.Popup();
              //popup.setLatLng(new L.LatLng(44, -122));
              popup.setContent(snowValue + " in.");
              layer.bindPopup(popup);
              layer.on('mouseover', function(e){
                this.openPopup();
              });
              layer.on('mouseout', function(e){
                this.closePopup();
              });
            },
            style: style
          }),
          legend: snowfall_legend
        },
        stateBorder: {
          layer: L.geoJson.ajax('assets/oregonBorder.geojson', {fillOpacity: 0, weight: 1, color: 'grey'})
        },
        snowfall: {
            layer: L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{x}/{y}')
        },
        test: {  // https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/export?dpi=96&transparent=true&format=png32&layers=show%3A3%2C7&bbox=-14009266.181845024%2C4329028.4521384975%2C-12120965.835088532%2C5821079.244264741&bboxSR=102100&imageSR=102100&size=1544%2C1220&f=image
                // https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/?service=wms&version=1.3.0&request=GetCapabilities&service=WMS&request=GetMap&layers=&styles=&format=image%2Fjpeg&transparent=false&version=1.1.1&width=256&height=256&srs=EPSG%3A3857&bbox=-12523442.714243278,5009377.085697314,-10018754.171394622,7514065.628545967
            layer: L.tileLayer.wms('https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Observations/NOHRSC_Snow_Analysis/MapServer/export?dpi=96&transparent=true&format=png32&layers=show%3A3%2C7&bboxSR=102100&imageSR=102100&f=image')
        },
        cartodb_dark: {layer: L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png')}
    };

    var scenes = {
        overview: {lat: 44.0000000, lng: -123.5000000, zoom: 7, name: 'Welcome', layers: []},
        mtHood: {lat: 45.372351, lng: -121.701401, zoom: 14, name: 'Mt. Hood', layers: [layers.ESRI]},
        countySnowDist: {lat: 44.256374, lng: -122.6576876, zoom: 7.4, name: 'County Snow Distribution', layers: [layers.counties]},
        countrySnowOverview: {lat: 44.0549563, lng: -118.0958048, zoom: 6, name: 'Country Snow Overview', layers: [layers.test]},
        oregonSnow: {lat: 44.256374, lng: -122.6576876, zoom: 7.4, name: 'Oregon Snow', layers: [layers.test, layers.stateBorder]},
        resortMap: {lat: 44.256374, lng: -122.6576876, zoom: 7.4, name: 'Resorts', layers: [layers.resorts, layers.stateBorder]},
        end: {lat: 44.0000000, lng: -123.5000000, zoom: 7, name: 'End'}
    };

    $('#storymap').storymap({
        scenes: scenes,
        baselayer: layers.cartodb_dark,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        credits: "",
        loader: true,
        scalebar: false,
        flyo: true,
        navwidget: true,

        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map($(".storymap-map")[0], {
                zoomControl: false, scrollWheelZoom: false, fadeAnimation: true,
                zoomAnimation: true
            }).setView([44, -120], 7);

            //add an miniglobe
            new L.Control.GlobeMiniMap({
                marker: 'red',
                position: 'bottomright'
            }).addTo(map);


            return map;
        }
    });



    function getColor(feature){
      if(feature.properties.STATE != 41){
        return outsideColor;
      }
      else{
        for(var i=0; i<grades.length-1; i++){
          if(feature.properties.Snowfall > grades[i] && feature.properties.Snowfall < grades[i+1]){
            return colors[i];
          }
        }
        if(feature.properties.Snowfall > grades[grades.length-1]){
          return colors[grades.length -1];
        }
      }
    }

    function style(feature){
      return{
        weight: 2,
        opacity: 1,
        color: 'grey',
        fillOpacity: .6,
        fillColor: getColor(feature)
      };
    }
</script>
</body>
</html>
